<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel de Processos - JMD Advocacia</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }
        .modal {
            display: none;
            position: fixed;
            z-index: 50;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.5);
            align-items: center;
            justify-content: center;
        }
        .modal-content {
            background-color: #fefefe;
            padding: 24px;
            border: 1px solid #888;
            width: 90%;
            max-width: 500px;
            border-radius: 0.5rem;
        }
        .animate-fade-in {
            animation: fadeIn 0.3s ease-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="antialiased">

    <div id="app" class="p-4 sm:p-6 lg:p-8">
        <header class="mb-8">
            <div class="max-w-7xl mx-auto">
                <div class="flex items-center justify-between">
                    <h1 class="text-3xl font-bold text-gray-800">JMD Advocacia</h1>
                    <h2 class="text-xl font-semibold text-gray-600">Painel de Acompanhamento Processual</h2>
                </div>
                <div class="w-full h-px bg-gray-200 mt-4"></div>
            </div>
        </header>

        <main class="max-w-7xl mx-auto">
            <!-- Controles e Filtros -->
            <div class="bg-white p-4 rounded-lg shadow-sm mb-6 flex flex-wrap items-center justify-between gap-4">
                <div class="flex-grow flex flex-wrap items-center gap-4">
                    <div class="relative w-full sm:w-auto flex-grow sm:flex-grow-0 sm:max-w-xs">
                        <i class="fa fa-search absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"></i>
                        <input id="searchInput" type="text" placeholder="Buscar por nº ou nome..." class="pl-10 pr-4 py-2 w-full border border-gray-300 rounded-md focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition">
                    </div>
                     <div class="relative w-full sm:w-auto flex-grow sm:flex-grow-0 sm:max-w-xs">
                        <select id="actionFilter" class="w-full pl-3 pr-10 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition appearance-none">
                            <option value="todos">Todos os Tipos</option>
                            <option value="Cível">Cível</option>
                            <option value="Trabalhista">Trabalhista</option>
                            <option value="Família">Família</option>
                            <option value="Outros">Outros</option>
                        </select>
                         <i class="fa fa-chevron-down absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 pointer-events-none"></i>
                    </div>
                    <div class="relative w-full sm:w-auto flex-grow sm:flex-grow-0 sm:max-w-xs">
                        <select id="statusFilter" class="w-full pl-3 pr-10 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition appearance-none">
                            <option value="todos">Todos os Status</option>
                            <option value="Aguardando Inicial">Aguardando Inicial</option>
                            <option value="Em Andamento">Em Andamento</option>
                            <option value="Em Execução">Em Execução</option>
                            <option value="Aguardando Recurso">Aguardando Recurso</option>
                            <option value="Concluído">Concluído</option>
                            <option value="Suspenso">Suspenso</option>
                        </select>
                         <i class="fa fa-chevron-down absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 pointer-events-none"></i>
                    </div>
                </div>
                 <div class="flex items-center gap-3">
                    <div class="relative inline-block text-left">
                        <div>
                            <button type="button" id="exportBtn" class="inline-flex justify-center w-full rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-sm font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-100 focus:ring-indigo-500" aria-haspopup="true" aria-expanded="true">
                                <i class="fa fa-download mr-2"></i>
                                Exportar
                                <svg class="-mr-1 ml-2 h-5 w-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                                    <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
                                </svg>
                            </button>
                        </div>
                        <div id="exportMenu" class="origin-top-right absolute right-0 mt-2 w-40 rounded-md shadow-lg bg-white ring-1 ring-black ring-opacity-5 focus:outline-none hidden z-10">
                            <div class="py-1" role="menu" aria-orientation="vertical" aria-labelledby="options-menu">
                                <a href="#" id="exportCsvBtn" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100" role="menuitem">Como CSV</a>
                                <a href="#" id="exportJsonBtn" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100" role="menuitem">Como JSON</a>
                            </div>
                        </div>
                    </div>
                    <button id="addProcessBtn" class="bg-indigo-600 text-white font-semibold py-2 px-5 rounded-md hover:bg-indigo-700 transition-colors shadow flex items-center gap-2">
                        <i class="fa fa-plus"></i>
                        <span>Novo Processo</span>
                    </button>
                </div>
            </div>

            <!-- Lista de Processos -->
            <div id="processList" class="space-y-4">
                <!-- Cards de processo serão inseridos aqui -->
            </div>
             <div id="no-results" class="hidden text-center py-10">
                <p class="text-gray-500 text-lg">Nenhum processo encontrado.</p>
            </div>
        </main>
    </div>

    <!-- Modal para Adicionar/Editar Processo -->
    <div id="processModal" class="modal">
        <div class="modal-content animate-fade-in">
            <form id="processForm">
                <h3 id="modalTitle" class="text-2xl font-bold mb-6 text-gray-800">Adicionar Novo Processo</h3>
                <input type="hidden" id="processId">
                <div class="space-y-4 max-h-[60vh] overflow-y-auto pr-2">
                    <div>
                        <label for="numeroProcesso" class="block text-sm font-medium text-gray-700 mb-1">Número do Processo</label>
                        <input type="text" id="numeroProcesso" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" required>
                    </div>
                    <div>
                        <label for="nomeCliente" class="block text-sm font-medium text-gray-700 mb-1">Nome do Cliente</label>
                        <input type="text" id="nomeCliente" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" required>
                    </div>
                    <div>
                        <label for="tipoAcao" class="block text-sm font-medium text-gray-700 mb-1">Tipo de Ação</label>
                        <select id="tipoAcao" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" required>
                            <option value="Cível">Cível</option>
                            <option value="Trabalhista">Trabalhista</option>
                            <option value="Família">Família</option>
                            <option value="Outros">Outros</option>
                        </select>
                    </div>
                    <div>
                        <label for="linkPainel" class="block text-sm font-medium text-gray-700 mb-1">Link do Painel</label>
                        <input type="url" id="linkPainel" placeholder="https://..." class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
                    </div>
                    <div>
                        <label for="situacao" class="block text-sm font-medium text-gray-700 mb-1">Situação</label>
                        <select id="situacao" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" required>
                            <option value="Aguardando Inicial">Aguardando Inicial</option>
                            <option value="Em Andamento">Em Andamento</option>
                            <option value="Em Execução">Em Execução</option>
                            <option value="Aguardando Recurso">Aguardando Recurso</option>
                            <option value="Concluído">Concluído</option>
                            <option value="Suspenso">Suspenso</option>
                        </select>
                    </div>
                    <div>
                        <label for="proximaAudiencia" class="block text-sm font-medium text-gray-700 mb-1">Próxima Audiência</label>
                        <input type="date" id="proximaAudiencia" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
                    </div>
                    <div>
                        <label for="observacao" class="block text-sm font-medium text-gray-700 mb-1">Observação</label>
                        <textarea id="observacao" rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500"></textarea>
                    </div>
                </div>
                <div class="mt-8 flex justify-end gap-3">
                    <button type="button" id="cancelBtn" class="px-4 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300 font-semibold transition">Cancelar</button>
                    <button type="submit" class="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 font-semibold transition">Salvar</button>
                </div>
            </form>
        </div>
    </div>
    
    <div id="confirmDeleteModal" class="modal">
        <div class="modal-content animate-fade-in w-full max-w-sm">
            <h3 class="text-xl font-bold text-gray-800">Confirmar Exclusão</h3>
            <p class="text-gray-600 mt-4 mb-6">Você tem certeza que deseja excluir este processo? Esta ação não pode ser desfeita.</p>
            <div class="flex justify-end gap-3">
                <button id="cancelDeleteBtn" class="px-4 py-2 bg-gray-200 text-gray-800 rounded-md hover:bg-gray-300 font-semibold transition">Cancelar</button>
                <button id="confirmDeleteBtn" class="px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 font-semibold transition">Excluir</button>
            </div>
        </div>
    </div>


<script>
document.addEventListener('DOMContentLoaded', () => {
    const addProcessBtn = document.getElementById('addProcessBtn');
    const processModal = document.getElementById('processModal');
    const confirmDeleteModal = document.getElementById('confirmDeleteModal');
    const cancelBtn = document.getElementById('cancelBtn');
    const processForm = document.getElementById('processForm');
    const processList = document.getElementById('processList');
    const modalTitle = document.getElementById('modalTitle');
    const processIdInput = document.getElementById('processId');
    const searchInput = document.getElementById('searchInput');
    const statusFilter = document.getElementById('statusFilter');
    const actionFilter = document.getElementById('actionFilter');
    const noResults = document.getElementById('no-results');
    const exportBtn = document.getElementById('exportBtn');
    const exportMenu = document.getElementById('exportMenu');
    const exportCsvBtn = document.getElementById('exportCsvBtn');
    const exportJsonBtn = document.getElementById('exportJsonBtn');

    let processes = JSON.parse(localStorage.getItem('processes')) || [];
    let processToDeleteId = null;

    const statusColors = {
        "Aguardando Inicial": "bg-yellow-100 text-yellow-800",
        "Em Andamento": "bg-blue-100 text-blue-800",
        "Em Execução": "bg-green-100 text-green-800",
        "Aguardando Recurso": "bg-purple-100 text-purple-800",
        "Concluído": "bg-gray-200 text-gray-800",
        "Suspenso": "bg-red-100 text-red-800",
    };
    
    const openModal = () => processModal.style.display = 'flex';
    const closeModal = () => processModal.style.display = 'none';

    const openConfirmDeleteModal = (id) => {
        processToDeleteId = id;
        confirmDeleteModal.style.display = 'flex';
    };
    const closeConfirmDeleteModal = () => {
        processToDeleteId = null;
        confirmDeleteModal.style.display = 'none';
    };

    addProcessBtn.addEventListener('click', () => {
        modalTitle.textContent = 'Adicionar Novo Processo';
        processForm.reset();
        processIdInput.value = '';
        openModal();
    });

    cancelBtn.addEventListener('click', closeModal);
    document.getElementById('cancelDeleteBtn').addEventListener('click', closeConfirmDeleteModal);

    window.addEventListener('click', (e) => {
        if (e.target == processModal) closeModal();
        if (e.target == confirmDeleteModal) closeConfirmDeleteModal();
        if (!exportBtn.contains(e.target) && !exportMenu.contains(e.target)) {
            exportMenu.classList.add('hidden');
        }
    });

    const saveProcesses = () => {
        localStorage.setItem('processes', JSON.stringify(processes));
        renderProcesses();
    };

    const formatDate = (dateString) => {
        if (!dateString) return 'Não definida';
        const date = new Date(dateString);
        const userTimezoneOffset = date.getTimezoneOffset() * 60000;
        return new Date(date.getTime() + userTimezoneOffset).toLocaleDateString('pt-BR');
    };

    const renderProcesses = () => {
        processList.innerHTML = '';
        const searchTerm = searchInput.value.toLowerCase();
        const filterStatus = statusFilter.value;
        const filterAction = actionFilter.value;

        const filteredProcesses = processes.filter(p => {
            const matchesSearch = p.numero.toLowerCase().includes(searchTerm) || (p.cliente && p.cliente.toLowerCase().includes(searchTerm));
            const matchesStatus = filterStatus === 'todos' || p.situacao === filterStatus;
            const matchesAction = filterAction === 'todos' || p.acao === filterAction;
            return matchesSearch && matchesStatus && matchesAction;
        });

        if (filteredProcesses.length === 0) {
            noResults.style.display = 'block';
        } else {
            noResults.style.display = 'none';
        }

        filteredProcesses.sort((a, b) => new Date(b.lastUpdated) - new Date(a.lastUpdated));

        filteredProcesses.forEach(p => {
            const color = statusColors[p.situacao] || 'bg-gray-100 text-gray-800';
            const card = `
                <div class="bg-white rounded-lg shadow-md p-5 border-l-4 border-indigo-500 transition hover:shadow-lg">
                    <div class="flex flex-wrap justify-between items-start gap-4">
                        <div class="flex-grow">
                            <div class="flex items-center gap-3 mb-2">
                               <span class="text-sm font-semibold py-1 px-3 rounded-full ${color}">${p.situacao}</span>
                            </div>
                            <h3 class="text-xl font-bold text-gray-800">${p.numero}</h3>
                            <p class="text-md font-semibold text-gray-700">${p.cliente || ''}</p>
                            <p class="text-md text-gray-600">${p.acao}</p>
                        </div>
                        <div class="flex-shrink-0 flex items-center gap-2">
                             ${p.link ? `<a href="${p.link}" target="_blank" class="text-indigo-600 hover:text-indigo-800 h-9 w-9 grid place-content-center rounded-full hover:bg-gray-100" title="Acessar Painel"><i class="fa fa-external-link-alt"></i></a>` : ''}
                            <button class="edit-btn text-blue-600 hover:text-blue-800 h-9 w-9 grid place-content-center rounded-full hover:bg-gray-100" data-id="${p.id}" title="Editar"><i class="fa fa-pencil-alt"></i></button>
                            <button class="delete-btn text-red-600 hover:text-red-800 h-9 w-9 grid place-content-center rounded-full hover:bg-gray-100" data-id="${p.id}" title="Excluir"><i class="fa fa-trash-alt"></i></button>
                        </div>
                    </div>
                    <div class="mt-4 pt-4 border-t border-gray-200">
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                            <div>
                                <p class="text-sm font-medium text-gray-500">Próxima Audiência</p>
                                <p class="text-md font-semibold text-gray-700 flex items-center gap-2"><i class="fa fa-calendar-alt text-gray-400"></i> ${formatDate(p.audiencia)}</p>
                            </div>
                            <div>
                                <p class="text-sm font-medium text-gray-500">Observação</p>
                                <p class="text-md text-gray-700">${p.obs || 'Nenhuma'}</p>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            processList.innerHTML += card;
        });
    };

    processForm.addEventListener('submit', (e) => {
        e.preventDefault();
        const id = processIdInput.value;
        const processData = {
            numero: document.getElementById('numeroProcesso').value,
            cliente: document.getElementById('nomeCliente').value,
            acao: document.getElementById('tipoAcao').value,
            link: document.getElementById('linkPainel').value,
            situacao: document.getElementById('situacao').value,
            audiencia: document.getElementById('proximaAudiencia').value,
            obs: document.getElementById('observacao').value,
            lastUpdated: new Date().toISOString()
        };

        if (id) {
            const index = processes.findIndex(p => p.id === id);
            processes[index] = { ...processes[index], ...processData };
        } else {
            processData.id = Date.now().toString();
            processes.push(processData);
        }

        saveProcesses();
        closeModal();
    });

    processList.addEventListener('click', (e) => {
        const editBtn = e.target.closest('.edit-btn');
        if (editBtn) {
            const id = editBtn.dataset.id;
            const process = processes.find(p => p.id === id);
            if (process) {
                modalTitle.textContent = 'Editar Processo';
                processIdInput.value = process.id;
                document.getElementById('numeroProcesso').value = process.numero;
                document.getElementById('nomeCliente').value = process.cliente;
                document.getElementById('tipoAcao').value = process.acao;
                document.getElementById('linkPainel').value = process.link;
                document.getElementById('situacao').value = process.situacao;
                document.getElementById('proximaAudiencia').value = process.audiencia;
                document.getElementById('observacao').value = process.obs;
                openModal();
            }
        }
        
        const deleteBtn = e.target.closest('.delete-btn');
        if (deleteBtn) {
            const id = deleteBtn.dataset.id;
            openConfirmDeleteModal(id);
        }
    });
    
    document.getElementById('confirmDeleteBtn').addEventListener('click', () => {
        if (processToDeleteId) {
            processes = processes.filter(p => p.id !== processToDeleteId);
            saveProcesses();
            closeConfirmDeleteModal();
        }
    });

    searchInput.addEventListener('input', renderProcesses);
    statusFilter.addEventListener('change', renderProcesses);
    actionFilter.addEventListener('change', renderProcesses);

    // Lógica de Exportação
    const downloadFile = (content, fileName, contentType) => {
        const a = document.createElement("a");
        const file = new Blob([content], { type: contentType });
        a.href = URL.createObjectURL(file);
        a.download = fileName;
        a.click();
        URL.revokeObjectURL(a.href);
    };

    const exportToCsv = () => {
        if (processes.length === 0) return;
        const headers = ["ID", "Numero do Processo", "Cliente", "Tipo de Ação", "Link", "Situação", "Próxima Audiência", "Observação", "Última Atualização"];
        
        const escapeCsvField = (field) => {
            if (field === null || field === undefined) return '';
            const stringField = String(field);
            if (stringField.search(/("|,|\n)/g) >= 0) {
                return `"${stringField.replace(/"/g, '""')}"`;
            }
            return stringField;
        };

        const rows = processes.map(p => [
            escapeCsvField(p.id),
            escapeCsvField(p.numero),
            escapeCsvField(p.cliente),
            escapeCsvField(p.acao),
            escapeCsvField(p.link),
            escapeCsvField(p.situacao),
            escapeCsvField(p.audiencia),
            escapeCsvField(p.obs),
            escapeCsvField(p.lastUpdated)
        ].join(','));
        
        const csvContent = [headers.join(','), ...rows].join('\n');
        downloadFile(csvContent, 'processos_jmd.csv', 'text/csv;charset=utf-8;');
    };

    const exportToJson = () => {
        if (processes.length === 0) return;
        const jsonContent = JSON.stringify(processes, null, 2);
        downloadFile(jsonContent, 'processos_jmd.json', 'application/json;charset=utf-8;');
    };

    exportBtn.addEventListener('click', () => {
        exportMenu.classList.toggle('hidden');
    });

    exportCsvBtn.addEventListener('click', (e) => {
        e.preventDefault();
        exportToCsv();
        exportMenu.classList.add('hidden');
    });

    exportJsonBtn.addEventListener('click', (e) => {
        e.preventDefault();
        exportToJson();
        exportMenu.classList.add('hidden');
    });

    renderProcesses();
});

</script>

</body>
</html>

